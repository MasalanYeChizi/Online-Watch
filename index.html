<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Screen Sharing</title>
</head>
<body>
    <h1>WebRTC Screen Sharing</h1>
    <button id="startShare">Start Sharing</button>
    <video id="remoteVideo" autoplay></video>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        const startShare = document.getElementById('startShare');
        const remoteVideo = document.getElementById('remoteVideo');

        // اتصال به سرور سیگنال‌دهی (آدرس سرور خود را وارد کنید)
        const socket = io('https://your-signaling-server.com'); // آدرس سرور سیگنال‌دهی
        let peerConnection;
        const config = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

        startShare.addEventListener('click', async () => {
            const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
            remoteVideo.srcObject = stream;

            peerConnection = new RTCPeerConnection(config);

            // افزودن استریم به PeerConnection
            stream.getTracks().forEach(track => peerConnection.addTrack(track, stream));

            // ارسال ICE Candidateها به سرور
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    socket.emit('ice-candidate', event.candidate);
                }
            };

            // ارسال Offer به سرور
            const offer = await peerConnection.createOffer();
            await peerConnection.setLocalDescription(offer);
            socket.emit('offer', offer);
        });

        // دریافت Offer از سرور
        socket.on('offer', async (offer) => {
            peerConnection = new RTCPeerConnection(config);

            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    socket.emit('ice-candidate', event.candidate);
                }
            };

            peerConnection.ontrack = (event) => {
                remoteVideo.srcObject = event.streams[0];
            };

            await peerConnection.setRemoteDescription(offer);
            const answer = await peerConnection.createAnswer();
            await peerConnection.setLocalDescription(answer);
            socket.emit('answer', answer);
        });

        // دریافت Answer از سرور
        socket.on('answer', async (answer) => {
            await peerConnection.setRemoteDescription(answer);
        });

        // دریافت ICE Candidateها از سرور
        socket.on('ice-candidate', async (candidate) => {
            await peerConnection.addIceCandidate(candidate);
        });
    </script>
</body>
</html>
