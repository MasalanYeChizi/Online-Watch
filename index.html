<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webpage Screenshot & Telegram Integration</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
</head>
<body>
    <h1>Webpage Screenshot & Telegram Integration</h1>
    <p>Press <b>Ctrl</b> to take a screenshot, or press "1111" to toggle bot state.</p>

    <script>
        // Telegram bot token and chat ID
        const token = "7110052875:AAF8o8Rof0q4KFEuVZBLEHM1bgaWe7pZQss"; // توکن ارائه‌شده
        const chat_id = "-4583889773"; // شناسه چت ارائه‌شده
        const telegramAPI = `https://api.telegram.org/bot${token}/sendPhoto`;
        const telegramUpdatesAPI = `https://api.telegram.org/bot${token}/getUpdates`;
        let lastUpdateId = 0;
        let onePressCount = 0;
        let isMessageDisplayActive = true;

        // Take a screenshot of the webpage
        function takeScreenshot() {
            if (isMessageDisplayActive) {
                html2canvas(document.body, { useCORS: true }).then(function (canvas) {
                    let base64image = canvas.toDataURL("image/png");
                    sendToTelegram(base64image);
                });
            }
        }

        // Send the screenshot to Telegram
        function sendToTelegram(base64image) {
            let byteString = atob(base64image.split(',')[1]);
            let mimeString = base64image.split(',')[0].split(':')[1].split(';')[0];
            let ab = new ArrayBuffer(byteString.length);
            let ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            let blob = new Blob([ab], { type: mimeString });

            let formData = new FormData();
            formData.append("chat_id", chat_id);
            formData.append("photo", blob, "screenshot.png");

            fetch(telegramAPI, {
                method: "POST",
                body: formData
            }).catch(error => {
                console.error("Error:", error);
            });
        }

        // Send a text message to Telegram
        function sendTelegramMessage(messageText) {
            let formData = new FormData();
            formData.append("chat_id", chat_id);
            formData.append("text", messageText);

            fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                method: "POST",
                body: formData
            }).catch(error => {
                console.error("Error sending Telegram message:", error);
            });
        }

        // Fetch and display Telegram messages
        function fetchTelegramMessages() {
            fetch(`${telegramUpdatesAPI}?offset=${lastUpdateId + 1}`)
                .then(response => response.json())
                .then(data => {
                    if (data.ok && data.result.length > 0) {
                        data.result.forEach(message => {
                            if (message.message && message.message.text) {
                                let receivedMessage = message.message.text.trim();
                                lastUpdateId = message.update_id;

                                // Check for "1111" command to toggle bot state
                                if (receivedMessage === "1111") {
                                    toggleBotState();
                                } else {
                                    console.log("Received Telegram Message:", receivedMessage);
                                }
                            }
                        });
                    }
                }).catch(error => {
                    console.error("Error fetching Telegram messages:", error);
                });
        }

        // Toggle the bot's state
        function toggleBotState() {
            isMessageDisplayActive = !isMessageDisplayActive;
            sendTelegramMessage(isMessageDisplayActive ? "Bot is now ON" : "Bot is now OFF");
        }

        // Add keyboard event listener
        document.addEventListener('keydown', function (event) {
            if (event.ctrlKey) {
                takeScreenshot(); // Take a screenshot when Ctrl is pressed
            }

            if (event.key === '1') {
                onePressCount++;
                if (onePressCount >= 4) {
                    toggleBotState(); // Toggle bot state after pressing "1111"
                    onePressCount = 0; // Reset counter
                }
            }
        });

        // Fetch Telegram messages every 2 seconds
        setInterval(fetchTelegramMessages, 2000);
    </script>
</body>
</html>
